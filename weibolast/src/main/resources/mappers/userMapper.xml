<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.weiboLast.demo.mapper.userMapper">
    <select id="selectUserByUserNameAndPassword" resultType="java.lang.Long">
        SELECT id FROM user
        WHERE username=#{username} AND password=#{password}
    </select>
    <insert id="insertUser">
        INSERT INTO user(username,gender,password,nickname,create_time)
        VALUES(#{username},#{gender.id},#{password},#{nickname},#{createTime})
    </insert>

    <select id="selectUser" resultType="com.weiboLast.demo.pojo.vo.UserVO2">
        SELECT id,username,nickname,password
        FROM user
        WHERE username=#{username}
        AND password=#{password}
    </select>
    <select id="collectAllUserNumber" resultType="java.lang.Long">
        SELECT COUNT(id)
        FROM user
    </select>
    <select id="showUserLists" resultType="com.weiboLast.demo.pojo.vo.UserVO">
        SELECT id,username
        FROM user
        ORDER BY create_time DESC,id DESC
        LIMIT #{pageNumber},#{number}
    </select>
    <update id="updateInfo">
        UPDATE user
        <set>
            <if test="#{userInfo.username}!=null and #{userInfo.username}!=''">
                username=#{userInfo.username},
            </if>
            <if test="#{userInfo.nickname}!=null and #{userInfo.nickname}!=''">
                nickname=#{userInfo.nickname},
            </if>
            <if test="#{userInfo.gender.id}!=null and #{userInfo.gender.id}!=''">
                gender=#{userInfo.gender.id}
            </if>
        </set>
        WHERE id=#{userId}
    </update>
    <update id="deleteUserById">
        UPDATE user
        SET is_alive=false
        WHERE id=#{id}
    </update>
    <update id="updateUserPassword">
        UPDATE user
        SET password=#{pwd.confirmNewPassword}
        WHERE id=#{userId}
    </update>

    <select id="selectPermession" resultType="java.lang.String">
        SELECT p.permession_code
        FROM user as u
        JOIN user_of_roles as ur ON u.id=ur.user_id
        JOIN roles as r ON ur.role_id=r.id
        JOIN role_have_permessions as pr ON r.id=pr.permession_id
        JOIN permession as p ON pr.permession_id=p.id
        WHERE u.id=#{id}
    </select>
</mapper>
